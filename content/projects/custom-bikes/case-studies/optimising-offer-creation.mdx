---
title: Optimising Offer Creation
description: This is the Optimising Offer Creation page!
---

# Key Components

## Offers Sheet

---

The **OFFERS** sheet is a critical component of the Custom Bikes system, meticulously designed to manage the status and make adjustments to customer offers. Projects remain in this stage until the customer makes the first or full payment, at which point they move to subsequent sheets and enter production. During this stage, it is essential to ensure that each project is correctly priced and that a PDF offer document is generated before progressing. The **OFFERS** sheet plays a vital role in accurately pricing and efficiently managing all customer offers.

Using a combination of unique identifiers, dynamic pricing formulas, and real-time data imports, the **OFFERS** sheet ensures accuracy, efficiency, and profitability in creating orders. It generates both the **System Price** and **Offer Price** and integrates seamlessly with the **INVENTORY** system. Dynamic dropdowns, generated from complex formulas, display project configurations and highlight problem items, further enhancing its functionality. Its organised layout and visual design streamline the offer creation process, allowing the team to focus on delivering quality and timely customer service, making it an indispensable component of the Custom Bikes system.

---

### UI and Visual Design

The **OFFERS** sheet is designed with a clean, organised layout to facilitate easy management of offers. Key visual elements include:

- **Header Colours**: The sheet features distinct header colours to differentiate sections. The main project details, such as IDs, key dates, customer name and contact information, configuration, and frame for the bike, are under the main header in grey. The configuration data (parts and accessories) is under a red header, while the "Design / Paintwork" section is highlighted in blue. This section contains essential data like the frame, fork, and every part and accessory. This grouped section is typically kept minimised to prevent the sheet from appearing too overwhelming.
- **Conditional Formatting**: Problem items in the **Problem Items** column are highlighted in red to immediately catch the user's attention.
- **Dropdown Menus**: Used extensively for statuses, currencies, VAT percentages, configurations, and other selections to maintain data consistency and accuracy.

---

### Column Headers and Explanation

| **Column Header**                | **Explanation**                                                                                                                                                                                                                                                                                                 |
| -------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **STATUS**                       | A dropdown containing the current status of the offer (e.g., NEW, WAITING..., OFFER DOC, PAID, REMOVE). NEW, WAITING..., OFFER DOC, and PAID track the offer stages. Selecting PAID triggers an alert to input the paid amount. Selecting REMOVE archives the project and removes it from the **OFFERS** sheet. |
| **CURRENCY**                     | A dropdown containing the currency (PLN, EUR) used in the offer. Critical for generating the system price and using the Google Finance formula for exchange rates.                                                                                                                                              |
| **VAT**                          | Dropdown containing the value-added tax percentage (e.g., options include: 0%, 19%, 23%). Custom values can also be entered.                                                                                                                                                                                    |
| **SYSTEM PRICE INC. VAT**        | The net price of the components, paintwork, estimates, and margin in PLN of the bike including VAT as calculated by the system. Later converted to EUR if selected. The System Price acts as the base price for the **Offer Price**.                                                                            |
| **OFFER PRICE INC. VAT**         | The price offered to the customer, including VAT and converted to EUR if selected as a currency. This price is typically rounded to a more attractive figure.                                                                                                                                                   |
| **SYSTEM ID**                    | Unique identifier for the project within the system, formatted as `[First 5 letters of surname/project name]-[First initial]-[Random 5-digit number]`.                                                                                                                                                          |
| **ID**                           | A sequential numerical identifier for the project, starting from the maximum existing number incremented by one.                                                                                                                                                                                                |
| **SURNAME / PROJECT**            | Customer's surname or project name. After the offer document is generated, this value turns into a hyperlink linking to its corresponding offer document.                                                                                                                                                       |
| **OWNER**                        | Sales representative handling the offer (e.g., Marek, Anna, Sandra).                                                                                                                                                                                                                                            |
| **CONFIGURATION**                | A dropdown containing the type of bike, drivetrain (e.g., Chain drive (Single Speed)), and a detailed list of all the components.                                                                                                                                                                               |
| **FRAME**                        | Specific frame type and size (e.g., City Man Frame 50 cm (S)).                                                                                                                                                                                                                                                  |
| **DESIGN / PAINTWORK**           | Custom paintwork details (e.g., Orange).                                                                                                                                                                                                                                                                        |
| **DESIGN / PAINTING COST (PLN)** | Cost of the custom design or paintwork.                                                                                                                                                                                                                                                                         |
| **EST. COST OF CONFIG (PLN)**    | Estimated cost of the bike configuration, calculated from a custom formula summing the costs of all parts and accessories.                                                                                                                                                                                      |
| **PROBLEM ITEMS**                | Any items not recognised by the system and requiring special attention. Highlighted in red for easy identification.                                                                                                                                                                                             |

---

### Sample Data Explanation

**Example: Thomas Richard's Offer:**

| **Column Header**                | **Example Data**           |
| -------------------------------- | -------------------------- |
| **STATUS**                       | OFFER DOC                  |
| **CURRENCY**                     | PLN                        |
| **VAT**                          | 23%                        |
| **SYSTEM PRICE INC. VAT**        | 8,636                      |
| **OFFER PRICE INC. VAT**         | 8,799                      |
| **SYSTEM ID**                    | THOM-R-66163               |
| **ID**                           | 0915                       |
| **SURNAME / PROJECT**            | Thomas                     |
| **OWNER**                        | Sandra                     |
| **CONFIGURATION**                | Chain drive (Single Speed) |
| **FRAME**                        | City Man Frame 50 cm (S)   |
| **DESIGN / PAINTWORK**           | Orange                     |
| **DESIGN / PAINTING COST (PLN)** | 100 zł                     |
| **EST. COST OF CONFIG (PLN)**    | 5,371 zł                   |
| **PROBLEM ITEMS**                | 1 item requiring attention |

---

### Key Features and Formulas

---

### Understanding System ID and ID

In the Custom Bikes system, two identifiers are used to uniquely distinguish each project: the **System ID** and the **ID**. Both serve specific purposes and are generated differently, playing complementary roles to maintain order and clarity within project management and manufacturing processes. These are generated during offer creation.

#### System ID

- **Structure:**
  - **Format:** `[First 5 letters of surname/project name]-[First initial]-[Random 5-digit number]`
  - **Example:** `THOM-R-66163` (Richard Thomas), `ANDE-J-38521` (Jessica Anderson)
- **Generation:**
  - Created upon offer creation using the customer's surname (or project name) and the first letter of the first name.
  - A 5-digit random number is appended to ensure uniqueness.
- **Purpose:**
  - **Readability:** Designed to be human-readable and easily recognisable.
  - **System Use:** Intuitive for internal use, helping quickly identify the project/customer.
  - **Uniqueness:** The combination of letters and a random number reduces duplication risk.

The **System ID** is crafted for readability and ease of use within digital interfaces, ensuring projects are easily identifiable within the system. This ID is particularly useful for system interfaces, documentation, and internal communications.

#### ID

- **Structure:**
  - **Format:** A sequential numerical sequence.
  - **Example:** `0915`, `0973`
- **Generation:**
  - Created by finding the highest current numerical value in the system, then incrementing it by one.
  - Ensures a unique and chronologically ordered identifier.
- **Purpose:**
  - **Internal Tracking:** Used internally for tracking projects within the manufacturing process.
  - **Physical Labelling:** Written on the bicycle frame's steerer tube or attached to the frame as a physical identifier.
  - **Customer Reference:** Used by customers when inquiring about their project status.

The **ID** provides a straightforward, sequential identifier for physical tracking and internal references, ensuring that each project is uniquely identifiable and easily traceable throughout the manufacturing process.

#### Comparison and Usage

Both identifiers are crucial for maintaining order and clarity within the project management and manufacturing processes at Custom Bikes. While the **System ID** combines parts of the customer’s name with a random number for readability and ease of reference in digital interfaces, the **ID** is a purely numerical sequence used for physical labelling and internal tracking.

#### Sample Data

| **System ID** | **ID** | **Surname / Project** | **First Name** |
| ------------- | ------ | --------------------- | -------------- |
| THOM-R-66163  | 0915   | Thomas                | Richard        |
| RODR-M-83907  | 0916   | Rodriguez             | Mary           |

---

### Handling Duplicates in System ID and ID Columns

To ensure each project in the Custom Bikes system has a unique identifier, conditional formatting is used to catch duplicates in both the **System ID** and **ID** columns. This helps maintain the integrity of our project tracking system.

#### Conditional Formatting for Duplicates

We use the `COUNTIFS` function in Google Sheets for this purpose. The `COUNTIFS` function counts the number of cells that meet a set of criteria. In this case, it checks for duplicate values in the **System ID** and **ID** columns.

**Example Conditional Formatting Formula for System ID Column:**

```plaintext
=COUNTIFS($M$5:$M,$M5)>1
```

**Explanation:**

The conditional formatting formula `=COUNTIFS

($M$5:$M,$M5)>1` is used to identify duplicates in the **System ID** column. The range `$M$5:$M`specifies the cells to be checked, starting from row 5 in column M. The`$M5`refers to the current cell in the column that the rule is applied to, and the`>1` condition checks if the count of the value in the specified range exceeds 1, indicating a duplicate.

When a duplicate is detected, the cell is formatted with a red background (#ff0000) and yellow text (#ffff00). This visual alert signals the project owner to take action and resolve the duplication. Once the issue is resolved, the formatting returns to normal.

By using this method, any duplicates in the **System ID** or **ID** columns are immediately flagged, allowing the project owner to address the issue promptly and maintain the accuracy of the project data.

---

### System Price and Offer Price Overview

The **System Price** and **Offer Price** in the Custom Bikes system are calculated to account for various factors such as currency, VAT, configuration costs, and additional costs related to preparation, assembly, and customer communication. These prices are dynamic and adjustable, providing flexibility for both project owners and customers. The use of formulas and Google Sheets functions like `ArrayFormula`, `VLOOKUP`, and `GoogleFinance` ensures accurate and real-time calculations, supporting the efficient management of offers and pricing.

**Sample Data**

Below is a table showing the key columns related to pricing and configuration costs in the **OFFERS** sheet. This helps in understanding how the various pricing components come together:

| **CURRENCY** | **VAT** | **SYSTEM PRICE INC. VAT** | **OFFER PRICE INC. VAT** | **EST. COST OF CONFIG (PLN)** | **DESIGN COST** | **NET EST. COST OF PREPARATION AND ASSEMBLY** | **NET EST. COST OF CUSTOMER COMM.** | **NET MARGIN** | **PRICE (SYSTEM) (PLN) NET** | **"CHARM" OFFER PRICE W/ VAT** |
| ------------ | ------- | ------------------------- | ------------------------ | ----------------------------- | --------------- | --------------------------------------------- | ----------------------------------- | -------------- | ---------------------------- | ------------------------------ |
| PLN          | 23%     | 8,636                     | 8,799                    | 5,371 zł                      | 100             | 300                                           | 250                                 | 1000           | 7021.39                      | 8,649.00                       |
| EUR          | 0%      | 1,051                     | 1,079                    | 2,846 zł                      | 100             | 300                                           | 250                                 | 1000           | 4496.38                      | 1,059.00                       |

---

#### System Price (SYSTEM PRICE INC. VAT)

The **System Price** is a dynamic calculation that considers the currency, VAT rate, net estimated cost of the bike configuration (all parts and accessories), net design and painting costs, net preparation and assembly costs, net customer communication costs, and net margin. This net price is calculated in PLN (Polish złoty) before applying the VAT rate and can be converted to EUR (Euro) by using the dropdown in the currency column or preset at the time of offer creation.

**Key Components of System Price Calculation:**

1. **Currency and VAT:**

   - **Currencies:** PLN, EUR
   - **VAT Rates:** 23%, 19%, 0%
   - Conditional formatting is used to apply blue (#1155cc) text to the **CURRENCY** and **VAT** columns if EUR is the value in the **CURRENCY** column.

2. **Components of the Net System Price:**

   - **Net Estimated Cost of Configuration:** Sum of all parts, accessories, frame, and fork. Calculated by summing up the costs of all individual components required to build the bike between columns AB and BW. This includes the frame, fork, parts, and accessories.
     **Formula for Net Estimated Cost of Configuration:**
     ```plaintext
     =ArrayFormula(SUM(IFERROR(VLOOKUP(QUERY(TRANSPOSE(FILTER(AB5:BW5, AB5:BW5 <> "")),"Select * where Col1 is not null"),{IMPORT!$B$5:$B, IMPORT!$I$5:$I},2,FALSE),0)))
     ```
     This formula uses `VLOOKUP` to find the cost of each component in the range from the imported data from the inventory system and sums them up.
   - **Net Design and Painting Costs:** Sum of the design and painting cost based on the specific design, adjustable for custom jobs.
   - **Net Preparation and Assembly Costs:** Estimated costs for preparing the frame and fork, including assembling the bike.
   - **Net Customer Communication Costs:** Time spent communicating with the customer.
   - **Net Margin:** Profit margin added on top of the other costs.

3. **Formula for Net System Price:**

   ```plaintext
   =Y5+BY5+SUM(CD5:CF5)
   ```

   This formula sums the net estimated cost of configuration, net design cost, preparation and assembly cost, and net customer communication cost, and adds the net margin to calculate the net system price.

4. **Formula for System Price inc. VAT:**
   ```plaintext
   =IF(M5<>"",IFS(D5="PLN",(CG5*E5)+CG5,D5="EUR",((CG5*(index(GoogleFinance("CURRENCY:PLNEUR", "price", I5), 2, 2)))*E5)+(CG5*(index(GoogleFinance("CURRENCY:PLNEUR", "price", I5), 2, 2)))),"")
   ```

This formula uses `GoogleFinance` for currency conversion and provides real-time exchange rates, dynamically updating the **System Price** based on the selected currency and VAT rate.

---

#### Offer Price

The **Offer Price** is the final price offered to the customer, including VAT. It can be adjusted separately from the **System Price** to provide discounts or other incentives. The **Offer Price** in the Custom Bikes system is designed to be more visually appealing and "charming" compared to the **System Price**. It is generated as soon as the offer is entered into the **OFFERS** sheet and is based on the **System Price**. The **Offer Price** is rounded to create an attractive figure and is used in the official offer document provided to the customer.

**Key Features:**

- **Dependent on System Price:** The **Offer Price** is calculated based on the **System Price**.
- **Charming Rounding:** The **Offer Price** is rounded to the nearest attractive number. This value is calculated in the Charm Offer Price (PLN) column and copied to the Offer Price after offer creation if the currency dropdown is changed in the **OFFERS** sheet.
- **Editable:** The **Offer Price** can be amended by the project owner before the offer document is generated.
- **Dynamic Updates:** Changing the currency of the offer will cause the **Offer Price** to be updated accordingly.
- **Dynamic Adjustment:** The **Offer Price** can be amended at any time before the project goes live and enters production.
- **Flexibility:** Allows project owners to provide competitive pricing or adjust based on negotiations with the customer.
- **Price Safety:** To maintain profitability and ensure that the **Offer Price** is not lower than the **System Price**, conditional formatting is used to highlight the **Offer Price** column if its value is less than the **System Price**.

**Calculation of "Charm" Offer Price**

The **Charm Offer Price** is designed to create a more appealing price for the customer by rounding the **System Price** to a more attractive number. This value is calculated in the **Charm Offer Price** column and ensures that the price is visually appealing while maintaining profitability.

**Formula:**

```plaintext
=IF(D5 = "PLN", IF(MOD(F5, 100) < 50, F5 - MOD(F5, 100) + 49, F5 - MOD(F5, 100) + 99), IF(D5 = "EUR", F5 + 9 - MOD(F5, 10), "Currency Not Defined"))
```

- **For PLN:** Rounds to the nearest attractive number ending in 49 or 99.
- **For EUR:** Rounds to the nearest attractive number ending in 9.

**Example:**

- **System Price (PLN):** 8,636
  - **Charm Offer Price (PLN):** 8,649 (rounded up to the nearest attractive number ending in 49 or 99)
- **System Price (EUR):** 1,051
  - **Charm Offer Price (EUR):** 1,059 (rounded up to the nearest attractive number ending in 9)

**Implementation in Google Sheets**

**Function for Applying Charm Price:**
The charm price is applied to the **Offer Price** column using Apps Script. This process involves copying the value from the **Charm Offer Price w/ VAT** column to the **Offer Price** column.

```javascript
function getCharmPrice(row) {
  // Returns charm price configuration for the new offer row
  return {
    source: [row, OFFERS.PRICE_CHARM_PLN_EUR],
    target: [row, OFFERS.OFFER_PRICE],
  };
}

function applyCharmPrice({ source, target }, offersSheet) {
  // Copies charm price from source to target cell
  const value = offersSheet.getRange(...source).getValue();
  offersSheet.getRange(...target).setValue(value);
}
```

---

### Config and Problem Items

The **OFFERS** sheet

contains several dropdowns whose values are dynamically populated from data derived from complex custom formulas hidden from view. These results are dynamically fed into dropdown UI elements in each row to allow for easier consumption of the data. These formulas provide essential details for displaying the bike's drivetrain from the convenience of a dropdown in each project row. Additionally, they monitor the integrity of the configuration data of each project in the **OFFERS** sheet to identify and provide feedback about unrecognised items in the order.

---

#### Config Dropdown and Projects Complete Config

This formula generates a comprehensive horizontal array of all configuration items required to complete a project. It is specifically designed to display the project's drivetrain and the entire project configuration along with the quantity needed for each item. The formula processes data across hidden cells in each project row in the **OFFERS** sheet and converts this data into a dropdown item. This allows users to view the complete configuration with a single click from the **Configuration** column.

The formula filters out wheel system choices since these details are only for documentation purposes and do not have associated prices. The output includes only the essential items needed for the project's assembly.

**Example Formula:**

```plaintext
={AA5,"******",ARRAYFORMULA(TRANSPOSE(COUNTIF(QUERY(TRANSPOSE(FILTER(AB5:BW5,ISNA(MATCH(AB5:BW5,{"Tubeless ready","Tubeless","Tubes"},0)))),"Select * where Col1 is not null"),QUERY(TRANSPOSE(FILTER(AB5:BW5,ISNA(MATCH(AB5:BW5,{"Tubeless ready","Tubeless","Tubes"},0)))),"Select * where Col1 is not null"))&" x "&QUERY(TRANSPOSE(FILTER(AB5:BW5,ISNA(MATCH(AB5:BW5,{"Tubeless ready","Tubeless","Tubes"},0)))),"Select * where Col1 is not null")))}
```

**Preview Output:**

|                            |          |                              |                           |                     |                                    |                              |                       |                       |                   |                   |                             |                                               |                        |                                             |                                             |                                           |                                           |                                      |                                           |                    |                                                 |                            |          |          |                             |                                     |                               |                               |                                   |                   |
| -------------------------- | -------- | ---------------------------- | ------------------------- | ------------------- | ---------------------------------- | ---------------------------- | --------------------- | --------------------- | ----------------- | ----------------- | --------------------------- | --------------------------------------------- | ---------------------- | ------------------------------------------- | ------------------------------------------- | ----------------------------------------- | ----------------------------------------- | ------------------------------------ | ----------------------------------------- | ------------------ | ----------------------------------------------- | -------------------------- | -------- | -------- | --------------------------- | ----------------------------------- | ----------------------------- | ----------------------------- | --------------------------------- | ----------------- |
| Chain drive (Single Speed) | **\*\*** | 1 x City Man Frame 50 cm (S) | 1 x Alu. Fork (City Bike) | 1 x Neco BB 107.5mm | 1 x Shimano Alfine S501 45T, 170mm | 1 x Gates CDX Chainring, 46T | 1 x Shimano BL-4700-L | 1 x Shimano BL-4700-R | 1 x Tektro R559-F | 1 x Tektro R559-R | 1 x Gates Carbon Drive Belt | 1 x CDX Rear Sprocket, 20T for Alfine / Nexus | 1 x City Wheelset 700c | 2 x Panaracer Gravelking SS 700x38C (Black) | 2 x Panaracer Gravelking SS 700x38C (Black) | 2 x Continental Tour 28 700-32-47 FV 60mm | 2 x Continental Tour 28 700-32-47 FV 60mm | 1 x Shimano Alfine 11 (SG-S7001) 32H | 1 x Components for Alfine 8-speed SG-S700 | 1 x Cruiser (Alu.) | 1 x Brooks Slender Leather Grips, 130mm (Black) | 1 x PRO LT 100mm/31.8 +/-6 | 1 x 3 cm | 1 x 1 cm | 1 x Semi-Integrated Headset | 1 x Shimano Alfine SL-S700 11-speed | 1 x Brooks C17 Carved (Black) | 1 x Suspension Seatpost 350mm | 1 x PRO LT Seatpost Clamp, 31.8mm | 1 x Shimano GR500 |

---

### Problem Items Column and the Problem Items Formula

This formula generates a horizontal array list by first counting the total number of unknown items (parts and accessories) concerning this project and listing each of those problem items along with their quantity. This formula is crucial because unrecognised items in the offer or order data mean the pricing for these items would be missed, and tracking stock levels would be difficult. The results from the formula are fed into and transposed into the dropdown to show the complete configuration column with a single click from the **Problem Items** column.

The formula filters out wheel system choices since these details are only for documentation purposes and do not have associated prices. The output includes only the essential items needed for the project's assembly.

**Example Formula:**

```plaintext
=IF(COUNTA(IFERROR(FILTER( QUERY(FILTER(AB5:BW5,ISNA(MATCH(AB5:BW5,{"Tubeless ready","Tubeless","Tubes"},0))),"Select * where Col1 is not null"),COUNTIF(IMPORT!$B$6:$B,QUERY(FILTER(AB5:BW5,ISNA(MATCH(AB5:BW5,{"Tubeless ready","Tubeless","Tubes"},0))),"Select * where Col1 is not null"))<1)))=0,,{ COUNTA(IFERROR(FILTER( QUERY(FILTER(AB5:BW5,ISNA(MATCH(AB5:BW5,{"Tubeless ready","Tubeless","Tubes"},0))),"Select * where Col1 is not null"),COUNTIF(IMPORT!$B$6:$B,QUERY(FILTER(AB5:BW5,ISNA(MATCH(AB5:BW5,{"Tubeless ready","Tubeless","Tubes"},0))),"Select * where Col1 is not null"))<1))),"******", ArrayFormula( TRANSPOSE( COUNTIF( QUERY(TRANSPOSE(FILTER(AA5:BW5,ISNA(MATCH(AA5:BW5,{"Tubeless ready","Tubeless","Tubes"},0)))),"Select * where Col1 is not null") , FILTER( QUERY(TRANSPOSE(FILTER(AB5:BW5,ISNA(MATCH(AB5:BW5,{"Tubeless ready","Tubeless","Tubes"},0)))),"Select * where Col1 is not null"),COUNTIF(IMPORT!$B$6:$B,QUERY(TRANSPOSE(FILTER(AB5:BW5,ISNA(MATCH(AB5:BW5,{"Tubeless ready","Tubeless","Tubes"},0)))),"Select * where Col1 is not null"))<1)) &" x "& FILTER( QUERY(TRANSPOSE(FILTER(AB5:BW5,ISNA(MATCH(AB5:BW5,{"Tubeless ready","Tubeless","Tubes"},0)))),"Select * where Col1 is not null"),COUNTIF(IMPORT!$B$6:$B,QUERY(TRANSPOSE(FILTER(AB5:BW5,ISNA(MATCH(AB5:BW5,{"Tubeless ready","Tubeless","Tubes"},0)))),"Select * where Col1 is not null"))<1)) )})
```

**Example Output:**

|     |          |                                  |
| --- | -------- | -------------------------------- |
| 1   | **\*\*** | 1 x Gravel Frame (Alu) 53 cm (L) |

In this case, there is only one known part. The letter '(L)' representing the size of the frame is incorrect. The system recognised it as (M), as shown in the following entry of the **PARTS & PRICES** sheet in the Inventory spreadsheet:

| Item Name                    | Item Code        | Manufacturer | Item  | Bike Type | Filtered by | Price (PLN) (NET) |
| ---------------------------- | ---------------- | ------------ | ----- | --------- | ----------- | ----------------- |
| Gravel Frame (Alu) 53 cm (M) | FRAME.ALU.ADV.50 | Custom Bikes | Frame | Gravel    | Frame       | 1,009.00          |

---

## Production Stages Overview

1. **PAINTING & PARTS**:

   - **Description**: This is the initial production stage where the project's painting progress is tracked, and parts are prepared for assembly.
   - **Data Transfer**: The project data is transferred from the OFFERS sheet to the PAINTING & PARTS sheet.

2. **Assembly & Testing**:

   - **Description**: In this stage, the project's assembly and testing progress is tracked.
   - **Data Transfer**: The project entry is transferred from the PAINTING & PARTS sheet to the Assembly & Testing sheet.

3. **Dispatch/Pick-Up**:

   - **Description**: This stage tracks the project's packing and dispatch progress.
   - **Data Transfer**: The project data is transferred from the Assembly & Testing sheet to the Dispatch/Pick-Up sheet.

4. **Complete**:
   - **Description**: The final stage where the project resides after production, providing a summary of its progression through the production stages and some financial information.
   - **Data Transfer**: The project data is transferred from the Dispatch/Pick-Up sheet to the Complete sheet.

---

## LIVE Sheet

The **LIVE** sheet is a comprehensive and dynamic tool that provides a real-time overview of all projects currently in production. It tracks the status and progress of each stage, customer care, and financial information. This sheet ensures that project owners have a clear and current view of all active projects, their stages, and any critical financial data.

### Example Data Explanation:

| Date Accepted | Deadline Date | Days Left | Priority | ▲     | System ID    | ID   | Surname / Project | First Name | Email                     | Telephone   | Owner | Config             | Status 1 | Status 2 | Status 3    | Num. Emails | Last Contacted | Days Ago | Contacted by | Satisfaction | Currency | VAT | Bike Price (Gross) | Bike Price (Net) (PLN) | Amount Paid (Gross) | Amount Remaining (Gross) | Amount Remaining (Net) (PLN) | CANCEL |
| ------------- | ------------- | --------- | -------- | ----- | ------------ | ---- | ----------------- | ---------- | ------------------------- | ----------- | ----- | ------------------ | -------- | -------- | ----------- | ----------- | -------------- | -------- | ------------ | ------------ | -------- | --- | ------------------ | ---------------------- | ------------------- | ------------------------ | ---------------------------- | ------ |
| 07/05/24      | 20/06/24      | -4        | 32%      | FALSE | JONE-M-22080 | 0873 | Jones             | Michael    | michael.jones@example.com | 61790952701 | Marek | Shimano GRX (1x11) | 15/06/24 | 22/06/24 | NOT STARTED | 5           | 22/06/24       | 2        | Anna         | 😃           | PLN      | 23% | 7,299              | 5,934                  | 3,650               | 3,650                    | 2,967                        |        |

### UI and Formatting

**Headers and Colours**:

- The headers are divided into sections, each with a distinct background colour for easy identification.
  - **Accepted Order Overview and Payments**: Black background with white text.
  - **Production Stages**: Colour-coded sections:
    - **1. PAINTING & PARTS**: Blue background.
    - **2. ASSEMBLY & TESTING**: Teal background.
    - **3. DISPATCH / PICK-UP**: Orange background.
  - **Customer Care**: Green background.
  - **Payment Details**: Gray background.

**Conditional Formatting**:

- **Days Left**: Conditional formatting is applied to highlight delays (negative values) in red.
- **Status Columns**: Colour-coded to reflect the current status of the project in each stage:
  - **PAINTING & PARTS**:
    - PAINT APPROVED ✓: Light blue
    - NOT STARTED: Gray
  - **ASSEMBLY & TESTING**:
    - ASSEMBLED: Teal
    - PROBLEM: Red
  - **DISPATCH / PICK-UP**:
    - NOT STARTED: Gray
    - DISPATCHED: Yellow
- **Customer Care**:
  - Satisfaction levels indicated by emoji smilies, affecting the priority score.

**Icons and Emojis**:

- **Satisfaction**: Uses emojis to visually represent customer satisfaction, enhancing the clarity of this data point.
- **Cancel Column**: Uses checkboxes to facilitate easy project cancellation.

### Sample Data

| Date Accepted | Deadline Date | Days Left | Priority | ▲     | System ID    | ID   | Surname / Project | First Name | Email                     | Telephone   | Owner | Config             | Status 1              | Status 2        | Status 3           | Num. Emails | Last Contacted | Days Ago | Contacted by | Satisfaction | Currency | VAT | Bike Price (Gross) | Bike Price (Net) (PLN) | Amount Paid (Gross) | Amount Remaining (Gross) | Amount Remaining (Net) (PLN) | CANCEL |
| ------------- | ------------- | --------- | -------- | ----- | ------------ | ---- | ----------------- | ---------- | ------------------------- | ----------- | ----- | ------------------ | --------------------- | --------------- | ------------------ | ----------- | -------------- | -------- | ------------ | ------------ | -------- | --- | ------------------ | ---------------------- | ------------------- | ------------------------ | ---------------------------- | ------ |
| 07/05/24      | 20/06/24      | -4        | 32%      | FALSE | JONE-M-22080 | 0873 | Jones             | Michael    | michael.jones@example.com | 61790952701 | Marek | Shimano GRX (1x11) | 15/06/24 (Light Blue) | 22/06/24 (Teal) | NOT STARTED (Gray) | 5           | 22/06/24       | 2        | Anna         | 😃           | PLN      | 23% | 7,299              | 5,934                  | 3,650               | 3,650                    | 2,967                        |        |

### Explanation:

- **Date Accepted**: The date when the order was accepted (07/05/24).
- **Deadline Date**: The deadline for the project (20/06/24).
- **Days Left**: The number of days left until the deadline (-4 indicates the deadline has passed).
- **Priority**: The priority percentage for the project (32%).
- **▲**: A boolean value indicating a specific condition (FALSE).
- **System ID**: Unique identifier for the system (JONE-M-22080).
- **ID**: Project ID (0873).
- **Surname / Project**: Customer's surname and project name (Jones).
- **First Name**: Customer's first name (Michael).
- **Email**: Customer's email address (michael.jones@example.com).
- **Telephone**: Customer's telephone number (61790952701).
- **Owner**: The person responsible for the project (Marek).
- **Config**: Configuration details (Shimano GRX (1x11)).
- **Status 1, 2, 3**: Status indicators for different stages of the project (dates (e.g. 15/06/24) (Light Blue), 22/06/24 (Teal), NOT STARTED (Gray)).
- **Num. Emails**: Number of emails exchanged (5).
- **Last Contacted**: Date when the customer was last contacted (22/06/24).
- **Days Ago**: Number of days since the last contact (2).
- **Contacted by**: The person who last contacted the customer (Anna).
- **Satisfaction**: Customer satisfaction indicator (😃).
- **Currency**: The currency used (PLN).
- **VAT**: VAT percentage (23%).
- **Bike Price (Gross)**: Total bike price including VAT (7,299).
- **Bike Price (Net) (PLN)**: Net bike price in Polish Złotych (PLN) excluding VAT (5,934).
- **Amount Paid (Gross)**: Total amount paid by the customer (3,650).
- **Amount Remaining (Gross)**: Amount remaining to be paid (3,650).
- **Amount Remaining (Net) (PLN)**: Net amount remaining in Polish Złotych (PLN) excluding VAT (2,967).
- **CANCEL**: A dropdown with the value of "CANCEL" for triggering the cancellation script.

### Key Features and Formulas:

1. **Deadline and Essential Project Data**:

   - **Data Import**: Essential project data, including the deadline, is imported from the ORDER_DATA sheet using VLOOKUP formulas.
   - **Example Formula**:
     ```plaintext
     =IF($G5="",,VLOOKUP($G5,ORDER_DATA!$I:$O,MATCH(H$4,ORDER_DATA!$I$4:$O$4,0),0))
     ```

2. **Days Left**:

   - **Functionality**: The Days Left column calculates the number of days remaining to complete the project. A negative number indicates the project is delayed.
   - **Example Formula**:
     ```plaintext
     =IF(E5="",,DAYS(C5,TODAY()))
     ```

3. **Priority**:

   - **Purpose**: The priority formula generates a score based on financial data, customer satisfaction, and deadline proximity, providing a comprehensive metric for project prioritization.
   - **Example Breakdown**:
     ```plaintext
     =IF(G5="", "", IF(X5="😡", 1, (40% * AF5/MAX($AF$5:$AF)) + (26% * AC5/MAX($AC$5:$AC)) + IFERROR(VLOOKUP(X5, { "😃", 1; "😐", 2; "😠", 3; "😡", 4 }, 2, FALSE), 1) * 8% + MAX(0, MIN(10% * (1 - (D5 / MAX($D$5:$D))), 10%))))
     ```

4. **Stage and Status Columns**:

   - **Functionality**: The sheet uses color-coded columns to indicate the stage of each project, correlating with different production stages (Painting and Parts, Assembly and Testing, Dispatch and Pick-Up).
   - **Example Formula for Status**:
     ```plaintext
     =IF(VLOOKUP(G18, {'1. PAINTING & PARTS'!$F:$F, '1. PAINTING & PARTS'!$O:$O}, 2, FALSE) = "PAINT APPROVED ✓", IF(VLOOKUP(G18, {'1. PAINTING & PARTS'!$F:$F, '1. PAINTING & PARTS'!$Y:$Y}, 2, FALSE) = "", "NOT STARTED", VLOOKUP(G18, {'1. PAINTING & PARTS'!$F:$F, '1. PAINTING & PARTS'!$Y:$Y}, 2, FALSE)), IF(VLOOKUP(G18, {'1. PAINTING & PARTS'!$F:$F, '1. PAINTING & PARTS'!$O:$O}, 2, FALSE) = "", "NOT STARTED", VLOOKUP(G18, {'1. PAINTING & PARTS'!$F:$F, '1. PAINTING & PARTS'!$O:$O}, 2, FALSE)))
     ```

5. **Customer Care: Communication**:

   - **Functionality**: This section tracks the number of emails sent to each customer, the last contact date, and who contacted them, ensuring consistent communication.
   - **Data Source**: Data is imported from the EMAILS sheet and refreshed daily.

6. **Customer Care: Satisfaction**:

   - **Functionality**: A drop-down menu with emoji smilies indicates customer satisfaction levels. This impacts the priority formula, ensuring that dissatisfied customers receive higher priority.

7. **Financials: Payment Details / Balance Tracking**:

   - **Data Tracked**: Currency, VAT, bike price (gross and net), amount paid, and remaining balance are tracked. All data is dynamically imported from the ORDER_DATA sheet.
   - **Purpose**: This section helps in tracking financial progress and ensuring internal consistency against costs.

8. **Cancelling a Live Project**:
   - **Functionality**: The Cancel column allows project owners to cancel a project. Selecting "Cancel" triggers a script that removes the project from production stages and updates the Offers Archive sheet.
   - **Example Script**:
     ```javascript
     function cancelOrderFromOms(omsSpreadsheet, selectedRow, selectedCell) {
       // ... (rest of the script)
     }
     ```

## PAINTING & PARTS Sheet

The **PAINTING & PARTS** sheet is the first stage of production where painting progress and parts preparation are meticulously tracked. This sheet provides a comprehensive overview of the project's status, ensuring that each project is properly prepared before moving to the next stage. Here, essential project data, deadlines, progress in painting, and parts availability are managed.

### Example Data:

| Date Started | Days Left | Priority | ▲     | System ID    | ID   | Surname / Project | Owner | Frame                      | Design | Frame Prep. | Frame Painted | Fork Painted | Status (Painting) | Config               | Availability | %   | Missing | Est. Cost of Missing | Non-Indexed | Focus | Status (Parts Prep.) | ▼     |
| ------------ | --------- | -------- | ----- | ------------ | ---- | ----------------- | ----- | -------------------------- | ------ | ----------- | ------------- | ------------ | ----------------- | -------------------- | ------------ | --- | ------- | -------------------- | ----------- | ----- | -------------------- | ----- |
| 22/05/24     | 16        | 21%      | FALSE | MART-W-73835 | 0912 | Martin            | Marek | City Woman Frame 56 cm (L) | Orange | YES         | YES           | YES          | PAINT APPROVED ✓  | Belt drive (Nexus 8) | 29/35        | 83% |         | 151.82               |             | TRUE  | PARTS READY          | FALSE |

### Explanation:

- **Date Started**: The date when the project started (22/05/24).
- **Days Left**: The number of days left for completion (16).
- **Priority**: The priority percentage for the project (21%).
- **▲**: A boolean value indicating a specific condition (FALSE).
- **System ID**: Unique identifier for the system (MART-W-73835).
- **ID**: Project ID (0912).
- **Surname / Project**: Customer's surname and project name (Martin).
- **Owner**: The person responsible for the project (Marek).
- **Frame**: Type and size of the frame (City Woman Frame 56 cm (L)).
- **Design**: Design color or style of the frame (Orange).
- **Frame Prep.**: Frame preparation status (YES).
- **Frame Painted**: Frame painting status (YES).
- **Fork Painted**: Fork painting status (YES).
- **Status (Painting)**: Current status of the painting process (PAINT APPROVED ✓).
- **Config**: Configuration details (Belt drive (Nexus 8)).
- **Availability**: Availability index (29/35).
- **%**: Percentage of completion or availability (83%).
- **Missing**: Missing parts or components (not specified).
- **Est. Cost of Missing**: Estimated cost of missing parts (151.82).
- **Non-Indexed**: Non-indexed status (not specified).
- **Focus**: Indicates if the project is in focus (TRUE).
- **Status (Parts Prep.)**: Current status of parts preparation (PARTS READY).
- **▼**: A boolean value indicating a specific condition (FALSE).

### Visual and UI Elements:

The **PAINTING & PARTS** sheet utilizes a color-coded system for easy identification and tracking of project progress. The use of colors helps visually communicate the status and urgency of tasks facilitating efficient management and timely progression through the production stages:

- **Blue Headers**: For sections related to "PAINTING PREP & TRACKING."
- **Red Headers**: For sections related to "PARTS HEALTH & PREPARATION."
- **Green Conditional Formatting**: Indicates "YES" statuses in painting progress, showing readiness and approval.
- **Grey Conditional Formatting**: Indicates "NO" statuses, highlighting areas requiring attention.
- **Conditional Formatting in Availability**:
  - **Green**: For 100% availability.
  - **Yellow**: For 70%-99% availability.
  - **Light Yellow**: For 40%-75% availability.
  - **Red**: For below 40% availability.

#### Key Features and Formulas:

**Deadline, Days Left, and Essential Project Data**:

The initial columns in this stage relate to the deadline, number of days left, and the priority score, followed by essential project information such as IDs, customer/project name, owner, etc. These details are imported from the ORDER_DATA sheet using VLOOKUP formulas, similar to those used in the LIVE section.

- **Data Import**: Essential project data, including the deadline, is imported from the ORDER_DATA sheet using VLOOKUP formulas.
- **Example Formula**:
  ```plaintext
  =IF($G5="",,VLOOKUP($G5,ORDER_DATA!$I:$O,MATCH(H$4,ORDER_DATA!$I$4:$O$4,0),0))
  ```

**Days Left**:

- **Functionality**: The Days Left column calculates the number of days remaining to complete the project. A negative number indicates the project is delayed.
- **Example Formula**:
  ```plaintext
  =IF(E5="",,DAYS(C5,TODAY()))
  ```

**The Painting Section: Painting and Parts**:

The **PAINTING & PARTS** sheet, which is Stage 1 of production, involves two major sections: the painting process and parts preparation.

**A Look at the Painting Section**:

| Frame                      | Design | Frame Prep. | Frame Painted | Fork Painted | Status (Painting) |
| -------------------------- | ------ | ----------- | ------------- | ------------ | ----------------- |
| City Woman Frame 56 cm (L) | Orange | YES         | YES           | YES          | PAINT APPROVED ✓  |

**Tracking Painting Progress**:

The painting team tracks the project's progress through columns by selecting "YES" or "NO" from dropdowns in these columns: (Frame Prep., Frame Painted, Fork Painted). By default, values are set to "NO". Conditional formatting (green for "YES" and grey for "NO") visually represents the progress.

**Painting: Status**:

The Status (Painting) column is initially set to "NOT STARTED" but updates automatically to "PAINTED" when all painting tracking columns (Frame Prep., Frame Painted, Fork Painted) read "YES". Status can be manually set, and this update reflects in the LIVE sheet.

**The Parts Section**:

This section involves formulas to show item availability, what’s missing, and estimated costs. It uses complex formulas for these purposes.

**Availability and Availability Percent**:

Availability is a count of in-stock parts against the total required parts. The percentage column converts this fraction to a percentage score. Rows are conditionally formatted to highlight availability status.

- **Availability Formula**:

  ```plaintext
  =IF(F5="",,COUNTA(IFERROR(ArrayFormula(FILTER(QUERY(TRANSPOSE(VLOOKUP(F5,ORDER_DATA!$I$5:$BL,SEQUENCE(1,48,9),FALSE)),"Select * where Col1 is not null"),IFERROR(VLOOKUP(QUERY(TRANSPOSE(VLOOKUP(F5,ORDER_DATA!$I$5:$BL,SEQUENCE(1,48,9),FALSE)),"Select * where Col1 is not null"),{IMPORT!$M$6:$M,IMPORT!$Q$6:$Q},2,0),0)>0))))&"/"&(COUNTA(IFERROR(ArrayFormula(QUERY(TRANSPOSE(VLOOKUP(F5,ORDER_DATA!$I$5:$BL,SEQUENCE(1,48,9),FALSE)),"Select \* where Col1 is not null"))))))
  ```

- **Percentage Formula**:

```plaintext
=IF(S5="",, VALUE(LEFT(S5,SEARCH("/",S5)-1))/VALUE(MID(S5,SEARCH("/",S5)+1,LEN(S5)-SEARCH("/",S5))))
```

- **Conditional Formatting Rules**:
  ```plaintext
  =AND($T5<>"",$T5=100%) (bgcolor: #b7e1cd)
  =AND($T5<>"",$T5>=70%,$T5<=99%) (bgcolor: #fce8b2)
  =AND($T5<>"",$T5>=40%,$T5<=75%) (bgcolor: #fbfcb2)
  =AND($T5<>"",$T5<=40%) (bgcolor: #f4c7c3)
  ```

**Missing**:

This column shows missing items, their quantities, and the specific missing parts using dropdown menus to avoid increasing row height. The formula used to populate this column provides a detailed breakdown of the missing items, leveraging the VLOOKUP function to fetch data from the ORDER_DATA sheet and other sources.

- **Example Formula**:
  ```plaintext
  ={VLOOKUP(F5,ORDER_DATA!$I$5:$BL,8,0),"******",ARRAYFORMULA(TRANSPOSE(COUNTIF(QUERY(TRANSPOSE(FILTER(ArrayFormula(VLOOKUP(F5,ORDER_DATA!$I$5:$BL,SEQUENCE(1,48,9),0)),ISNA(MATCH(VLOOKUP(F5,ORDER_DATA!$I$5:$BL,SEQUENCE(1,48,9),0),{"Tubeless ready","Tubeless","Tubes"},0)))),"Select * where Col1 is not null"),QUERY(TRANSPOSE(FILTER(ArrayFormula(VLOOKUP(F5,ORDER_DATA!$I$5:$BL,SEQUENCE(1,48,9),0)),ISNA(MATCH(VLOOKUP(F5,ORDER_DATA!$I$5:$BL,SEQUENCE(1,48,9),0),{"Tubeless ready","Tubeless","Tubes"},0)))),"Select * where Col1 is not null"))&" x "&QUERY(TRANSPOSE(FILTER(ArrayFormula(VLOOKUP(F5,ORDER_DATA!$I$5:$BL,SEQUENCE(1,48,9),0)),ISNA(MATCH(VLOOKUP(F5,ORDER_DATA!$I$5:$BL,SEQUENCE(1,48,9),0),{"Tubeless ready","Tubeless","Tubes"},0)))),"Select * where Col1 is not null")))}
  ```

**Estimated Cost of Missing**:

This custom formula calculates the total cost of missing parts, looking up missing items and their prices from the inventory. This allows for precise budgeting and planning for the completion of the project.

- **Example Formula**:
  ```plaintext
  =ArrayFormula(SUM(IFERROR(VLOOKUP(FILTER( QUERY(TRANSPOSE(VLOOKUP(F5,ORDER_DATA!$I$5:$BL,SEQUENCE(1,48,9),FALSE)),"Select * where Col1 is not null"), IFERROR(VLOOKUP(QUERY(TRANSPOSE(VLOOKUP(F5,ORDER_DATA!$I$5:$BL,SEQUENCE(1,48,9),FALSE)),"Select * where Col1 is not null"),{IMPORT!$M$6:$M,IMPORT!$Q$6:$Q},2,0),0)<=0),{IMPORT!$B$5:$B,IMPORT!$I$5:$I},2,0),0)))
  ```

**Focus Column**:

The Focus column contains tick boxes allowing users to select projects for detailed analysis. Selected projects are filtered into a separate sheet called "FOCUSED", providing a list of missing items and their costs, enabling efficient parts preparation. This feature helps prioritize projects with parts readily available and highlights those needing additional resources.

**Parts: Status**:

This column tracks the status of parts preparation with values such as PARTS NOT PREP., PREPARING PARTS, and PARTS READY. This status is crucial for transitioning projects from the painting phase to the assembly and testing stages.

---

## ASSEMBLY & TESTING Sheet

The ASSEMBLY & TESTING sheet is the second stage of production, split into two main sections: tracking the progress for Assembly and for Testing. This sheet ensures that each project progresses smoothly through the assembly process and subsequent testing, providing detailed tracking and accountability.

### Example Data

| Date Started | Deadline Date | Days Left | Priority | ▲     | System ID    | ID   | Surname / Project | Owner  | Config             | Mechanic | Comments | Status        | Test Mechanic | Result |
| ------------ | ------------- | --------- | -------- | ----- | ------------ | ---- | ----------------- | ------ | ------------------ | -------- | -------- | ------------- | ------------- | ------ |
| 12/06/24     | 24/06/24      | -2        | 31%      | FALSE | DAVI-S-61731 | 0871 | Davis             | Sandra | Shimano GRX (2x12) | Tom      |          | BIKE ACCEPTED | Zosia         | PASS   |

### Explanation

- **Date Started**: The date when the project started (12/06/24).
- **Deadline Date**: The deadline for the project (24/06/24).
- **Days Left**: The number of days left until the deadline (-2 indicates the deadline has passed).
- **Priority**: The priority percentage for the project (31%).
- **▲**: A boolean value indicating a specific condition (FALSE).
- **System ID**: Unique identifier for the system (DAVI-S-61731).
- **ID**: Project ID (0871).
- **Surname / Project**: Customer's surname and project name (Davis).
- **Owner**: The person responsible for the project (Sandra).
- **Config**: Configuration details (Shimano GRX (2x12)).
- **Mechanic**: The mechanic assigned to the assembly of the bike (Tom).
- **Comments**: Comments or notes regarding the assembly (not specified in the example).
- **Status**: Current status of the assembly process (BIKE ACCEPTED).
- **Test Mechanic**: The mechanic assigned to test the bike (Zosia).
- **Result**: The result of the testing phase (PASS).

### Visual and UI Elements

The ASSEMBLY & TESTING sheet utilizes a color-coded system for easy identification and tracking of project progress. The use of colors helps visually communicate the status and urgency of tasks:

- **Teal Headers**: For sections related to "ASSEMBLY PROGRESS & TRACKING."
- **Green Headers**: For sections related to "TESTING."
- **Purple Conditional Formatting**: Indicates "BIKE ACCEPTED" statuses in assembly progress, showing readiness and approval.
- **Yellow Conditional Formatting**: Indicates "IN PROGRESS" statuses, highlighting ongoing tasks.
- **Red Conditional Formatting**: Indicates "PROBLEM" statuses, flagging issues that need attention.
- **Green Conditional Formatting in Testing**: Indicates "PASS" results in testing.

#### Key Features and Formulas:

**Deadline, Days Left, and Essential Project Data**

The initial columns in this stage relate to the deadline, number of days left, and the priority score, followed by essential project information such as IDs, customer/project name, owner, etc. These details are imported from the ORDER_DATA and LIVE sheets using VLOOKUP formulas.

- **Data Import**: Essential project data, including the deadline, is imported from the ORDER_DATA sheet using VLOOKUP formulas.
- **Example Formula**:
  ```plaintext
  =IF($G5="",,VLOOKUP($G5,ORDER_DATA!$I:$O,MATCH(H$4,ORDER_DATA!$I$4:$O$4,0),0))
  ```

**Days Left**

- **Functionality**: The Days Left column calculates the number of days remaining to complete the project. A negative number indicates the project is delayed.
- **Example Formula**:
  ```plaintext
  =IF($G5="",,VLOOKUP($G5,{LIVE!$G:$G,LIVE!D:D},2,0))
  ```

**Status**

Like each production stage, there is a status column. The values in the status column include Not Started, In Progress, Assembled, Photo, Tick Symbol, Bike Accepted, and Problem. These values are manually updated to reflect the current status of the project in the assembly and testing stages.

### The Assembly Section

The ASSEMBLY & TESTING sheet, which is Stage 2 of production, involves two sections: the assembly process and testing.

#### A Look at the Assembly Section

| Mechanic | Comments | Status        |
| -------- | -------- | ------------- |
| Tom      |          | BIKE ACCEPTED |

**Assign a Mechanic**

- **Functionality**: A dropdown allows the assignment of a mechanic to each project, with options including "Tom", "Zosia", and "Radek". This ensures accountability and proper tracking of who is responsible for the assembly.
- **Mechanic Assignment**: The assigned mechanic's data is logged in the ORDER_DATA sheet to maintain a record and hold accountability.

**Comments**

- **Functionality**: This column allows the team to write comments or pass on notes regarding the assembly or progress of the project. This is essential for internal communication and tracking any issues or special notes.

### The Testing Section

Here's a look at the testing section:

| Test Mechanic | Result |
| ------------- | ------ |
| Zosia         | PASS   |

**Test Mechanic**

- **Functionality**: Similar to the assembly mechanic, this dropdown assigns a mechanic for testing, with options including "Zosia", "Tom", and "Radek". The idea is to have a different mechanic for testing to ensure an unbiased assessment.
- **Accountability**: The mechanic responsible for testing is recorded in the ORDER_DATA sheet.

**Test Column**

- **Functionality**: This column indicates the result of the testing phase, with values being either "PASS" or "FAIL". This binary result simplifies the tracking of whether the bike has passed the testing phase or needs further attention.

## DISPATCH & PICK-UP Sheet

The DISPATCH & PICK-UP sheet is the third and final stage in the production process. This sheet focuses on managing the logistics of delivering or picking up completed bikes, ensuring all financial and documentation requirements are met before the bike leaves the production facility.

### Example Data

| Date Started | ▲     | System ID    | ID   | Surname / Project | Owner | Delivery Method | Pick-Up Code / Address     | Currency | Outstanding | Receipt / Invoice | Documents | Status     |
| ------------ | ----- | ------------ | ---- | ----------------- | ----- | --------------- | -------------------------- | -------- | ----------- | ----------------- | --------- | ---------- |
| 21/06/24     | FALSE | ANDE-K-17890 | 0875 | Anderson          | Marek | DELIVERY        | 95 Main St, Czech Republic | PLN      | 2,250       | RECEIPT           | NOT READY | READY      |
| 21/06/24     | FALSE | JONE-J-38732 | 0882 | Jones             | Marek | PICK-UP         | JONE-J-38732               | PLN      | 4,225       | RECEIPT           | READY     | DISPATCHED |

### Explanation

- **Date Started**: The date when the project entered the dispatch and pick-up stage (21/06/24).
- **▲**: A boolean value indicating a specific condition (FALSE).
- **System ID**: Unique identifier for the system (ANDE-K-17890).
- **ID**: Project ID (0875).
- **Surname / Project**: Customer's surname and project name (Anderson).
- **Owner**: The person responsible for the project (Marek).
- **Delivery Method**: Indicates whether the project is to be delivered or picked up (DELIVERY).
- **Pick-Up Code / Address**: For delivery, it shows the address; for pick-up, it shows the system ID (95 Main St, Czech Republic).
- **Currency**: The currency used for the transaction (PLN).
- **Outstanding**: The remaining amount to be paid by the customer (2,250).
- **Receipt / Invoice**: Indicates whether a receipt or an invoice is needed (RECEIPT).
- **Documents**: Status of the necessary documents (NOT READY).
- **Status**: Current status of the project in this stage (READY).

### Visual and UI Elements

The DISPATCH & PICK-UP sheet employs a color-coded system for better visual management of tasks and statuses. The use of colors helps communicate the current status and requirements clearly and quickly:

- **Golden Yellow Headers**: For sections related to "DISPATCH."
- **Green Conditional Formatting**: Indicates "READY" statuses, showing that the project is prepared for dispatch.
- **Purple Conditional Formatting**: Indicates "DISPATCHED" statuses, showing that the bike has left the facility.
- **Yellow Conditional Formatting**: Indicates "IN PROGRESS" statuses, highlighting tasks currently being worked on.
- **Grey Conditional Formatting**: Indicates "NOT STARTED" statuses, flagging tasks that have yet to begin.

#### Key Features and Formulas

**Date Started and Essential Project Data**

Unlike previous stages, this sheet simplifies the initial columns, focusing primarily on the date the project entered this stage and essential customer information. The configuration column is omitted as it is no longer necessary.

- **Example Data Columns**:
  - Date Started
  - System ID
  - ID
  - Surname / Project
  - Owner

**Managing Delivery or Pick-Up**

This section handles the logistics of how the bike will be handed over to the customer.

| Delivery Method | Pick-Up Code / Address           |
| --------------- | -------------------------------- |
| DELIVERY        | 95 Main St, Czech Republic       |
| PICK-UP         | [System ID used as pick-up code] |

- **Delivery Method**: A dropdown menu with options "DELIVERY" or "PICK-UP".
- **Pick-Up Code / Address**: If "DELIVERY" is selected, the customer's address is retrieved from the ORDER_DATA sheet using the system ID. If "PICK-UP" is selected, the system ID is used as a pick-up code for security purposes.

- **Example Formula**:
  ```plaintext
  =IF(D5="",,IFS(H5 = "DELIVERY", VLOOKUP(D5,{ORDER_DATA!$I$5:$I, ORDER_DATA!$BR$5:$BR}, 2, 0), H5 = "PICK-UP", D5, H5 = "", ""))
  ```

**Ensuring the Project is Paid**

This section ensures that all financial obligations are settled before the bike is handed over to the customer.

| Currency | Outstanding |
| -------- | ----------- |
| PLN      | 2,250       |

- **Currency**: Indicates the currency in which the payment is made.
- **Outstanding**: Displays the remaining amount to be paid by the customer. Ensuring the outstanding amount is collected is crucial at this stage, whether it is collected before delivery or during pick-up.

**Columns for Receipts and Invoices**

| Receipt / Invoice | Documents |
| ----------------- | --------- |
| RECEIPT           | NOT READY |

- **Receipt / Invoice**: Indicates whether the customer requires a receipt or an invoice. The values can be "RECEIPT" or "INVOICE".
- **Documents**: Indicates the status of the required documents, whether they are "READY" or "NOT READY". This ensures that all necessary documentation is prepared before the bike is dispatched or picked up.

**Status Column**

This column tracks the overall status of the project in the dispatch and pick-up stage.

- **Values**:
  - READY
  - DISPATCHED
  - IN PROGRESS
  - NOT STARTED

## COMPLETE Sheet

The COMPLETE sheet is the final stage in the production process, where all completed projects are listed from the first ever to the latest. This sheet serves as a comprehensive record of each project's journey from start to finish, including financial summaries, key dates, and summaries of each production stage.

### Example Data

| ▲     | System ID    | ID   | Surname / Project | Owner | Config             | Curr | VAT | Bike Price + VAT | Bike Price (PLN) (Net) | Total Costs (PLN) Net | Net Margin | Offer Date | Date Accepted | Date Completed | Prod. Time | Days Late | Deadline | Stage 1 Complete | Design | Design Cost | Net Est. Cost of Parts and Accessories | Num. Days | Stage 2 Complete | Mechanic | Tested | Net Est. Cost of Preparation and Assembly | Num. Days | Stage 3 Complete | Delivery Method | Num. Days |
| ----- | ------------ | ---- | ----------------- | ----- | ------------------ | ---- | --- | ---------------- | ---------------------- | --------------------- | ---------- | ---------- | ------------- | -------------- | ---------- | --------- | -------- | ---------------- | ------ | ----------- | -------------------------------------- | --------- | ---------------- | -------- | ------ | ----------------------------------------- | --------- | ---------------- | --------------- | --------- |
| FALSE | LOPE-S-92085 | 0004 | Lopez             | Marek | Shimano GRX (1x11) | PLN  | 23% | 16,149           | 13,129                 | 12,088                | 1,042      | 30/01/23   | 03/02/23      | 02/03/23       | 27         | 6         | 24/02/23 | 23/02/23         | Yellow | 100         | 11,438 zł                              | 20        | 26/02/23         | Zosia    | Tom    | 300                                       | 3         | 02/03/23         |                 | 4         |

### Explanation

- **▲**: A boolean value indicating a specific condition (FALSE).
- **System ID**: Unique identifier for the system (LOPE-S-92085).
- **ID**: Project ID (0004).
- **Surname / Project**: Customer's surname and project name (Lopez).
- **Owner**: The person responsible for the project (Marek).
- **Config**: Configuration details (Shimano GRX (1x11)).
- **Curr**: The currency used (PLN).
- **VAT**: The VAT rate applied (23%).
- **Bike Price + VAT**: The total bike price including VAT (16,149 PLN).
- **Bike Price (PLN) (Net)**: The net bike price excluding VAT (13,129 PLN).
- **Total Costs (PLN) Net**: The total production costs (12,088 PLN).
- **Net Margin**: The profit margin (1,042 PLN).
- **Offer Date**: The date the offer was made (30/01/23).
- **Date Accepted**: The date the offer was accepted (03/02/23).
- **Date Completed**: The date the project was completed (02/03/23).
- **Prod. Time**: The total production time in days (27 days).
- **Days Late**: The number of days the project was late (6 days).
- **Deadline**: The deadline for the project (24/02/23).
- **Stage 1 Complete**: The completion date of Stage 1 (23/02/23).
- **Design**: The design of the bike (Yellow).
- **Design Cost**: The cost of the design (100 PLN).
- **Net Est. Cost of Parts and Accessories**: The estimated cost of parts and accessories (11,438 zł).
- **Num. Days**: The number of days spent in Stage 1 (20 days).
- **Stage 2 Complete**: The completion date of Stage 2 (26/02/23).
- **Mechanic**: The mechanic responsible for assembly and testing (Zosia).
- **Tested**: The mechanic who tested the bike (Tom).
- **Net Est. Cost of Preparation and Assembly**: The estimated cost for preparation and assembly (300 PLN).
- **Num. Days**: The number of days spent in Stage 2 (3 days).
- **Stage 3 Complete**: The completion date of Stage 3 (02/03/23).
- **Delivery Method**: The method of delivery (not specified in this example).
- **Num. Days**: The number of days spent in Stage 3 (4 days).

### Visual and UI Elements

The COMPLETE sheet employs a structured layout and color-coded system for better visual management and clarity:

- **Dark Grey Headers**: Indicating the summary section for financials and key dates.
- **Light Blue Conditional Formatting**: For the columns related to the painting stage.
- **Teal Conditional Formatting**: For the columns related to the assembly stage.
- **Green Conditional Formatting**: For the columns related to the dispatch stage.
- **Bold and Centered Headers**: To clearly distinguish between different sections and data types.

#### Key Features and Formulas:

**Summary Section: Financials**

| Currency | VAT | Bike Price + VAT | Bike Price (PLN) (Net) | Total Costs (PLN) Net | Net Margin |
| -------- | --- | ---------------- | ---------------------- | --------------------- | ---------- |
| PLN      | 23% | 16,149           | 13,129                 | 12,088                | 1,042      |

The financial summary section provides an overview of the project's financials, including:

- **Currency**: The currency used (PLN).
- **VAT**: The VAT rate applied (23%).
- **Bike Price + VAT**: The total bike price including VAT (16,149 PLN).
- **Bike Price (PLN) (Net)**: The net bike price excluding VAT (13,129 PLN).
- **Total Costs (PLN) Net**: The total production costs (12,088 PLN).
- **Net Margin**: The profit margin (1,042 PLN).

This section helps determine whether the project was profitable by comparing the bike price to the total production costs.

**Summary Section: Documentation of Key Dates**

| Offer Date | Date Accepted | Date Completed | Prod. Time | Days Late | Deadline |
| ---------- | ------------- | -------------- | ---------- | --------- | -------- |
| 30/01/23   | 03/02/23      | 02/03/23       | 27         | 6         | 24/02/23 |

This section records all the important dates for each project, allowing us to track its timeline and assess any delays:

- **Offer Date**: The date the offer was made (30/01/23).
- **Date Accepted**: The date the offer was accepted (03/02/23).
- **Date Completed**: The date the project was completed (02/03/23).
- **Prod. Time**: The total production time in days (27 days).
- **Days Late**: The number of days the project was late (6 days).
- **Deadline**: The deadline for the project (24/02/23).

**Production Stage Summaries**

For each production stage, we provide a summary that includes the completion date, design details, costs, and time spent in that stage.

\*\*Stage 1: PAINTING & PARTS\*\*

| Stage 1 Complete | Design | Design Cost | Net Est. Cost of Parts and Accessories | Num. Days |
| ---------------- | ------ | ----------- | -------------------------------------- | --------- |
| 23/02/23         | Yellow | 100         | 11,438 zł                              | 20        |

- **Stage 1 Complete**: The completion date of Stage 1 (23/02/23).
- **Design**: The design of the bike (Yellow).
- **Design Cost**: The cost of the design (100 PLN).
- **Net Est. Cost of Parts and Accessories**: The estimated cost of parts and accessories (11,438 zł).
- **Num. Days**: The number of days spent in this stage (20 days).

**Stage 2: Assembly & Testing**

| Stage 2 Complete | Mechanic | Tested | Net Est. Cost of Preparation and Assembly | Num. Days |
| ---------------- | -------- | ------ | ----------------------------------------- | --------- |
| 26/02/23         | Zosia    | Tom    | 300                                       | 3         |

- **Stage 2 Complete**: The completion date of Stage 2 (26/02/23).
- **Mechanic**: The mechanic responsible for assembly and testing (Zosia).
- **Tested**: The mechanic who tested the bike (Tom).
- **Net Est. Cost of Preparation and Assembly**: The estimated cost for preparation and assembly (300 PLN).
- **Num. Days**: The number of days spent in this stage (3 days).

**Stage 3: Dispatch & Pick-Up**

| Stage 3 Complete | Delivery Method | Num. Days |
| ---------------- | --------------- | --------- |
| 02/03/23         | DELIVERY        | 4         |

- **Stage 3 Complete**: The completion date of Stage 3 (02/03/23).
- **Delivery Method**: The method of delivery (not specified in this example).
- **Num. Days**: The number of days spent in this stage (4 days).

## IMPORT Sheet

The **IMPORT** sheet is a crucial component of the Custom Bikes system, ensuring dynamic data integration between the inventory management system and the Order Management System (OMS). It holds imported data from two key sheets in the INVENTORY spreadsheet: **PARTS & PRICES** and **STOCK LEVELS**. The live data connection, maintained using import formulas, keeps the data updated and accurate. The IMPORT sheet integrates live data from the INVENTORY spreadsheet into the OMS, ensuring real-time updates and accuracy. By drawing crucial data from the PARTS & PRICES and STOCK LEVELS sheets, it supports efficient inventory management and project processing within the Custom Bikes system. The protection and dynamic nature of this sheet make it an indispensable component of the overall system.

### Import Formulas and Their Functionality

The **IMPORT** sheet uses specific formulas to import data from the INVENTORY spreadsheet, ensuring a dynamic connection that updates automatically. The formulas used are:

- **Parts & Prices Import Formula**:

  ```plaintext
  =QUERY(IMPORTRANGE("1HcPv3Uuj7tJvdcgMznnpkacGBmL_1iFv3wAUx3sunTc","'PARTS & PRICES'!A8:I"),"SELECT * WHERE Col3 <> ''")
  ```

  This formula imports data from the **PARTS & PRICES** sheet in the INVENTORY spreadsheet, selecting all columns from A to I, starting from row 8, where Column 3 (typically the item code or description) is not empty.

- **Stock Levels Import Formula**:
  ```plaintext
  =QUERY(IMPORTRANGE("1HcPv3Uuj7tJvdcgMznnpkacGBmL_1iFv3wAUx3sunTc","STOCK_DATA!B6:O"),"SELECT * WHERE Col1 <> ''")
  ```
  This formula imports data from the **STOCK LEVELS** sheet in the INVENTORY spreadsheet, selecting columns B to O, starting from row 6, where Column 1 (typically the item code) is not empty.

### Imported Data in the Inventory Management System

**Parts & Prices**:

The **PARTS & PRICES** sheet provides a comprehensive catalog of parts and prices for the Custom Bikes system. It is organized by item type, manufacturer, bike type, and price in PLN (net). Key sections include frames and forks, drivetrain components, wheels, cockpit components, and accessories. Each entry is detailed with item codes and specific features, aiding in efficient parts management and procurement.

- **Importance**:
  - The entire system relies on this sheet for verifying parts and accessories in the OMS.
  - Unrecognized items cannot be priced or processed.
  - Regular updates to prices keep offers competitive and profitable.
  - Supports tools related to parts preparation and assembly.

**Stock Levels**:

The **STOCK LEVELS** sheet is vital for providing detailed information on stock levels, allocation, and pricing data for various parts and accessories. It includes columns for item code, name, manufacturer, item type, allocated to assembly, available for pre-assembly, total stock, project demand, missing, surplus, net item price, and the net value of items.

- **Importance**:
  - Underpins the entire inventory management process.
  - Ensures stock availability for project completion in the OMS.
  - Tracks stock in and out, updating automatically with project completion data.
  - Helps in maintaining better cash flow and making informed purchasing decisions.

### Protection and Accessibility

The **IMPORT** sheet is hidden and protected to prevent accidental changes or loss of connection. Access is limited to ensure the integrity and accuracy of the data.

## FOCUSED Sheet

The FOCUSED sheet is a crucial tool for managing project inventory by providing detailed insights into missing items and their associated costs. It plays an essential role in ensuring that projects from the PAINTING & PARTS section are well-prepared before moving to the ASSEMBLY & TESTING stage. Here’s a comprehensive explanation:

### Integration with PAINTING & PARTS

Projects from the PAINTING & PARTS section can be filtered into the FOCUSED sheet based on the selection in a main dropdown menu. This dropdown has two settings:

1. **PAINTING & PARTS (Focused)**: Only projects with ticked checkboxes in the "Focus" column of the PAINTING & PARTS sheet are filtered into the FOCUSED sheet. This allows for a concentrated analysis of selected projects.
2. **PAINTING & PARTS (All)**: All projects from the PAINTING & PARTS sheet are included in the FOCUSED sheet, providing a comprehensive view of all ongoing projects.

### Focus Column in PAINTING & PARTS

The "Focus" column in the PAINTING & PARTS sheet includes checkboxes that users can tick to select projects for detailed analysis. These selected projects are then displayed in the FOCUSED sheet for easier tracking and prioritization. This feature is essential for prioritizing projects with readily available parts and identifying those that require additional resources.

### Sections of the FOCUSED Sheet

The FOCUSED sheet consists of two main sections:

1. **Project Filter Section**: This section allows the team to filter and display projects based on the dropdown selection (Focused or All).

   | System ID    | Days Left | Priority | ID  | Surname / Project | Drivetrain           | Cost of Missing (NET) (PLN) | Full Amount Paid | Amount Remaining (NET) (PLN) | Difference (NET) (PLN) |
   | ------------ | --------- | -------- | --- | ----------------- | -------------------- | --------------------------- | ---------------- | ---------------------------- | ---------------------- |
   | MART-W-73835 | 16        | 21%      | 912 | Martin            | Belt drive (Nexus 8) | 151.82 zł                   | FALSE            | 1,030 zł                     | 878 zł                 |
   | TAYL-B-27319 | 6         | 38%      | 909 | Taylor            | Shimano GRX (2x12)   | 4,534.76 zł                 | FALSE            | 5,324 zł                     | 790 zł                 |

2. **MISSING ITEMS AND VALUE FOR FOCUSED PROJECTS**: This is a detailed inventory list for the projects included in the FOCUSED section. It provides a comprehensive overview of missing items and their values, sorted by the number of missing items or other criteria for better analysis.

   | Code    | Name                 | Manufacturer | Item        | Allocated to Assembly | Available for Pre-Assembly | Total Stock | Project Demand | Missing | Value of Missing Items (PLN) (NET) |
   | ------- | -------------------- | ------------ | ----------- | --------------------- | -------------------------- | ----------- | -------------- | ------- | ---------------------------------- |
   | 11568   | SKS Dual Carbon Cage | SKS          | Bottle cage | 7                     | 41                         | 48          | 12             | 29      | 1,392 zł                           |
   | BL4700L | Shimano BL-4700-L    | Shimano      | Brake Lever | 10                    | 24                         | 34          | 10             | 14      | 980 zł                             |

### Inventory Columns Breakdown

Here’s a detailed explanation of each column in the inventory:

1. **Code**: A unique identifier for each item.
2. **Name**: The name or model of the item.
3. **Manufacturer**: The manufacturer of the item.
4. **Item**: The type or category of the item.
5. **Allocated to Assembly**: Number of items currently allocated or reserved for projects in the ASSEMBLY & TESTING stage.
6. **Available for Pre-Assembly**: Number of items available for use that aren't reserved for ASSEMBLY & TESTING. These are the items available to pre-assemble projects in the PAINTING & PARTS section.
7. **Total Stock**: Total number of items in stock, including parts reserved for ASSEMBLY & TESTING.
8. **Project Demand**: Number of items needed to complete the focused projects.
9. **Missing**: Number of items currently missing to meet the demand (Available for Pre-Assembly - Project Demand).
10. **Value of Missing Items (PLN) (NET)**: The net value in PLN (Polish Zloty) of the missing items.

### Summary

At the top of the sheet, a summary provides the total value of missing items in PLN, helping the team quickly understand the financial impact of the shortages. This allows the team to analyze what is missing and how much it will cost to bring the parts inventory up to 100%, ensuring projects are ready to move to the ASSEMBLY & TESTING stage efficiently.

## EMAILS Sheet

The **EMAILS** sheet is an integral part of the project's communication management, designed to track and summarize email interactions between project owners and customers. This sheet helps the team ensure timely and effective communication, ultimately aiming to meet customer expectations and successfully complete projects.

Powered by automated scripts, the EMAILS sheet ensures efficient tracking and management of customer communication. It integrates seamlessly with the LIVE sheet, providing real-time insights into the communication health of each project and helping the team maintain high customer satisfaction.

### Key Team Members

- **Marek**, **Sandra**, and **Anna**: Responsible for creating offers, managing projects, maintaining communication with customers, and ensuring projects meet customer expectations and are completed successfully.

### Purpose of the EMAILS Sheet

The **EMAILS** sheet collects and summarizes data about email communications between the project owners and customers. It remains hidden in the system, serving as a backend tool for data collection. The summarized data is imported into the **LIVE** sheet, where the team can monitor customer email communications to ensure no customers are neglected.

### Structure of the EMAILS Sheet

The sheet is divided into several sections:

1. **Project Details**

   - **System ID**
   - **ID**
   - **Surname / Project**
   - **Email**

2. **Communication Tracking by Team Members**

   - Each team member (Craig, Marek, Sandra, and Anna) has two columns:
     - **Num. Emails**: Number of emails sent to the customer.
     - **Last Message**: Date of the last email sent.

3. **Summary Columns**
   - **Num. Emails**: Total number of emails sent to the customer.
   - **Last Message**: Date of the last email sent.
   - **Days Ago**: Number of days since the last email was sent.
   - **Sender**: The team member who sent the last email.

### Scripts for Email Tracking

Two main functions are run via a nightly trigger to update the EMAILS sheet:

1. **getInfoOnEmailsSentTo()**
   - This function gathers information on emails sent to customers.
   - It identifies which team member is running the script and updates the respective columns (Num. Emails and Last Message) for that team member.
   - It searches the Gmail inbox for emails sent from the team member to each customer's email address, counts the number of emails, and records the date of the last message.

```javascript
function getInfoOnEmailsSentTo() {
  const emailsSheet = omsSpreadsheet.getSheetByName(EMAILS.NAME);
  const teamMemberEmail = Session.getActiveUser().getEmail();
  let emailCountColumn, lastMessageColumn;

  switch (teamMemberEmail) {
    case 'craig@craigscott.me':
      emailCountColumn = EMAILS.NUM_EMAILS_CRAIG;
      lastMessageColumn = EMAILS.LAST_MSG_CRAIG;
      break;
    case 'marek@custombikes.com':
      emailCountColumn = EMAILS.NUM_EMAILS_MAREK;
      lastMessageColumn = EMAILS.LAST_MSG_MAREK;
      break;
    case 'sandra@custombikes.com':
      emailCountColumn = EMAILS.NUM_EMAILS_SANDRA;
      lastMessageColumn = EMAILS.LAST_MSG_SANDRA;
      break;
    case 'anna@custombikes.com':
      emailCountColumn = EMAILS.NUM_EMAILS_ANNA;
      lastMessageColumn = EMAILS.LAST_MSG_ANNA;
      break;
    default:
      Logger.log('Script not configured for the current user.');
      return;
  }

  for (let row = EMAILS.START_ROW; row <= emailsSheet.getLastRow(); row++) {
    const emailAddressToCheck = emailsSheet
      .getRange(row, EMAILS.EMAIL)
      .getValue();
    if (!emailAddressToCheck) {
      Logger.log(`No target email address provided in row ${row}.`);
      continue;
    }

    let latestDate = null;
    let emailCount = 0;
    const threads = GmailApp.search(
      `in:sent from:${teamMemberEmail} to:${emailAddressToCheck}`
    );

    threads.forEach((thread) => {
      const messages = thread.getMessages();
      emailCount += messages.length;
      messages.forEach((message) => {
        const date = message.getDate();
        if (!latestDate || date > latestDate) {
          latestDate = date;
        }
      });
    });

    emailsSheet.getRange(row, emailCountColumn).setValue(emailCount);
    if (latestDate) {
      emailsSheet
        .getRange(row, lastMessage

Column)
        .setValue(latestDate)
        .setNumberFormat('dd/MM/yy');
    } else {
      emailsSheet.getRange(row, lastMessageColumn).setValue('N/A');
    }
  }
}
```

2. **updateEmailCommunicationStats()**
   - This function copies relevant project data from the **LIVE** sheet to the **EMAILS** sheet.
   - It reads the data from the **LIVE** sheet, prepares it, clears existing data in the **EMAILS** sheet, and writes the new data.

```javascript
function updateEmailCommunicationStats() {
  const omsSpreadsheet = SpreadsheetApp.openById(OMS_SS.OMS_ID);
  const statusSheet = omsSpreadsheet.getSheetByName(LIVE.NAME);
  const emailsSheet = omsSpreadsheet.getSheetByName(EMAILS.NAME);
  const startRow = 5;

  const columnsToCopy = {
    statusSystemIdCol: LIVE.SYSTEM_ID,
    statusIdCol: LIVE.ID,
    statusSurnameProjectCol: LIVE.SURNAME_PROJECT,
    statusEmailCol: LIVE.EMAIL,
  };

  const numRows = statusSheet.getLastRow() - startRow + 1;
  if (numRows <= 0) {
    Logger.log('No data to copy.');
    return;
  }

  const data = statusSheet
    .getRange(startRow, 1, numRows, statusSheet.getLastColumn())
    .getValues();
  const dataToWrite = data.map((row) => [
    row[columnsToCopy.statusSystemIdCol - 1],
    row[columnsToCopy.statusIdCol - 1],
    row[columnsToCopy.statusSurnameProjectCol - 1],
    row[columnsToCopy.statusEmailCol - 1],
  ]);

  if (emailsSheet.getLastRow() - startRow + 1 > 1) {
    emailsSheet
      .getRange(
        startRow,
        1,
        emailsSheet.getLastRow() - startRow + 1,
        EMAILS.LAST_MSG_ANNA
      )
      .clearContent();
  }

  emailsSheet
    .getRange(startRow, 1, dataToWrite.length, dataToWrite[0].length)
    .setValues(dataToWrite);
  insertDummyDataToEmails();
}
```

### Data Flow and Usage

The data returned from these functions writes values into the EMAILS sheet, which contains rows of live projects imported from the **LIVE** sheet. The EMAILS sheet includes columns for each Sales and Project Owner team member to track the number of emails sent and the last message date.

The summarized data from the EMAILS sheet is then imported into the **LIVE** sheet using a `VLOOKUP` formula:

```plaintext
=ArrayFormula(VLOOKUP(G5,{EMAILS!$A$5:$A,EMAILS!$M$5:$P},SEQUENCE(1,4,2),0))
```

